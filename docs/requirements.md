# ByteSip 要件定義書

## 概要

### エージェント名
**ByteSip**

### ネーミングの由来
- **Byte**: 情報の単位
- **Bite**: 一口かじる（Byteと同音）
- **Sip**: 一口飲む
- **Ship**: 届ける（日本語話者向けの言葉遊び）

「Byte（情報）をBite（一口）サイズでSip（飲む）」というコンセプト。

### コンセプト
毎日のIT/AIニュースを一口サイズで届けるAIエージェント。
エンジニアが朝のコーヒーを飲みながら、その日のテック情報をキャッチアップできる。

### ターゲット
エンジニア一般（日本語話者）

---

## 技術スタック

| 項目 | 技術 |
|------|------|
| エージェントフレームワーク | Strands Agents |
| インフラ | Amazon Bedrock AgentCore |
| 外部API呼び出し | AgentCore Gateway → Lambda関数（Python） |
| キャッシュ | DynamoDB |
| メモリ | AgentCore Memory（STM/LTM） |

### アーキテクチャ概要

```
┌─────────────┐     ┌──────────────────┐     ┌─────────────────┐
│   User      │────▶│  Strands Agent   │────▶│ AgentCore       │
│ (Streamlit) │     │  (Bedrock)       │     │ Gateway         │
└─────────────┘     └──────────────────┘     └────────┬────────┘
                              │                       │
                              │                       ▼
                              │               ┌───────────────┐
                              │               │ Lambda関数    │
                              │               │ (news-fetcher)│
                              │               └───────┬───────┘
                              │                       │
                              │         ┌─────────────┼─────────────┐
                              │         ▼             ▼             ▼
                              │   ┌──────────┐ ┌──────────┐ ┌──────────┐
                              │   │ Qiita    │ │ Zenn     │ │ GitHub   │
                              │   │ API      │ │ RSS      │ │ API      │
                              │   └──────────┘ └──────────┘ └──────────┘
                              │                       │
                              │                       ▼
                              │               ┌───────────────┐
                              │               │  DynamoDB     │
                              │               │  (Cache)      │
                              │               └───────────────┘
                              │
                              ▼
                    ┌──────────────────┐
                    │ AgentCore Memory │
                    │ (STM/LTM)        │
                    └──────────────────┘
```

### Lambda関数構成

| 関数名 | 役割 |
|--------|------|
| `bytesip-news-fetcher` | 全ソース（Qiita/Zenn/GitHub）のニュース取得 |

### キャッシュ構成

| リソース | 用途 |
|----------|------|
| DynamoDB | 外部API取得結果のキャッシュ |

#### キャッシュ設計

| 項目 | 値 |
|------|-----|
| TTL | 1日 |
| キャッシュ保持件数 | 各サービス30件（合計90件） |
| 1回の提案上限 | 各サービス10件（合計30件） |

```
【重複排除の仕組み】

キャッシュ: 90件保持（Qiita 30 + Zenn 30 + GitHub 30）
     ↓
1回目: 30件提案 → STMに記憶
     ↓
2回目: 「他のはある？」 → キャッシュ90件 − STM30件 = 60件から提案
     ↓
3回目: 「他のはある？」 → 残り30件を提案
     ↓
4回目: 「これ以上はありません」
```

```
┌─────────────────────────────────────────────────────┐
│ bytesip-news-fetcher (Lambda)                       │
│                                                     │
│  ┌─────────┐  ┌─────────┐  ┌─────────┐            │
│  │ Qiita   │  │ Zenn    │  │ GitHub  │            │
│  │ Handler │  │ Handler │  │ Handler │            │
│  └────┬────┘  └────┬────┘  └────┬────┘            │
│       │            │            │                  │
│       └────────────┼────────────┘                  │
│                    ▼                               │
│            ┌──────────────┐                        │
│            │  DynamoDB    │                        │
│            │  (Cache)     │                        │
│            │  TTL: 1日    │                        │
│            │  保持: 90件  │                        │
│            └──────────────┘                        │
└─────────────────────────────────────────────────────┘
```

---

## 情報ソース

| ソース | 方式 | Rate Limit | 用途 |
|--------|------|------------|------|
| Qiita | 公式API | 認証済み: 1,000回/時、未認証: 60回/時 | トレンド記事取得 |
| Zenn | 公式RSS | 明示的な制限なし（常識的な頻度で） | トレンド記事取得 |
| GitHub | Search API | 30回/分 | トレンドリポジトリ取得 |

### エンドポイント詳細

#### Qiita
- トレンド: `GET /api/v2/items` （query パラメータでフィルタ）
- 人気記事フィード: `https://qiita.com/popular-items/feed`
- 認証: アクセストークンをAuthorizationヘッダに含める

#### Zenn
- トレンド（全体）: `https://zenn.dev/feed`
- トピック別: `https://zenn.dev/topics/{topicname}/feed`
- ユーザー別: `https://zenn.dev/{username}/feed`

#### GitHub
- Search API: `GET /search/repositories`
- トレンド代替クエリ:
  - 最近更新 + 高Star: `?q=pushed:>2025-01-01+stars:>100&sort=stars&order=desc`
  - 最近作成 + 高Star: `?q=created:>2025-01-01+stars:>50&sort=stars&order=desc`
- 認証: Personal Access Token推奨
- **注意**: 「最近Star急増」は公式APIでは取得不可。「最近更新/作成 + 高Star」で代替

---

## インターフェース

| フェーズ | 方式 | 備考 |
|----------|------|------|
| 開発中 | Streamlit | Webフロントエンド |
| 本番 | A2Aプロトコル対応 | 他エージェントからの呼び出しを想定 |

---

## 機能要件

### MVP（必須機能）

#### 1. ニュース提案
- 「今日のニュース教えて」でニュースを提案
- レスポンス形式:
  - タイトル（要約）
  - URL
  - 内容要約
  - 技術タグ配列

#### 2. ソース指定
- 「Qiitaのニュースだけ教えて」
- 「Zennだけ」「GitHubだけ」など

#### 3. 件数指定
- 「3件だけ教えて」「もっとたくさん」
- **1回の提案上限: 1サービス10件、合計30件**
- **キャッシュ保持: 1サービス30件、合計90件**
- 「他のはある？」で最大3回まで追加提案可能

#### 4. 技術タグフィルタ
- 「Pythonに関するニュースだけ」
- 「AIに関するものだけ」など

#### 5. 重複排除
- STM（短期記憶）で提案済みニュースを記憶
- 「ほかのニュースはある？」で重複しない提案

### MVP2（後回し）

| 機能 | 説明 | 備考 |
|------|------|------|
| 期間指定 | 「今週のニュース」「直近3日」 | キャッシュバイパス（直接API呼び出し） |
| 深掘り | 「2番目の記事をもっと詳しく教えて」 | |
| ブックマーク | 「これ後で読む」で保存 | |

---

## 運用方針

### Lambda関数

| 項目 | 内容 |
|------|------|
| ランタイム | Python |
| エラーハンドリング | 最低限（例外キャッチ、エラーレスポンス返却） |

### ログ・モニタリング

| 項目 | 内容 |
|------|------|
| ログ | 最低限（Lambda標準のCloudWatch Logs） |
| モニタリング | Lambda標準メトリクス |

---

## 参考リンク

- [Qiita API v2 ドキュメント](https://qiita.com/api/v2/docs)
- [ZennをRSSフィードで購読する](https://zenn.dev/zenn/articles/zenn-feed-rss)
- [GitHub REST API - Search](https://docs.github.com/en/rest/search)
